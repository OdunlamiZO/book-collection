const emptyResult = `
  <div id="empty-result">
    <svg fill="none" height="155" viewBox="0 0 160 155" width="160"><path d="M87.538 92.1827C97.9431 92.1645 106.519 94.2223 114.589 98.2723C116.331 99.0502 117.883 100.197 119.138 101.632C119.933 102.664 120.369 104.903 119.77 105.838C119.061 106.944 117.043 107.783 115.639 107.724C113.96 107.656 112.218 106.694 110.692 105.799C98.8416 98.8465 86.2305 98.0448 73.1575 101.083C66.1964 102.7 60.7311 106.722 56.2288 112.153C55.7263 112.759 55.2808 113.415 54.7797 114.021C53.7294 115.286 52.7144 117.294 50.7784 115.975C48.8824 114.685 49.353 112.551 50.4074 110.829C54.8386 103.583 60.9255 98.3014 68.9991 95.4147C74.9745 93.3853 81.2285 92.2951 87.538 92.1827Z" fill="black"/><path d="M54.0803 78.0532C49.5096 77.8419 45.3919 76.3223 42.2702 72.6393C40.9518 71.0819 39.9117 69.2014 41.677 67.5533C43.3916 65.9518 44.9043 67.2879 46.2816 68.6632C52.0293 74.3986 59.4542 72.6177 62.1736 64.9002C62.5481 63.8384 62.8954 62.7651 63.3248 61.7271C64.0019 60.0945 65.3176 58.879 66.9746 59.6333C67.5691 59.9691 68.0816 60.4329 68.475 60.9909C68.8685 61.5489 69.1331 62.1873 69.2498 62.86C69.4694 65.0038 69.1479 67.1683 68.3148 69.1557C67.4816 71.1431 66.1634 72.8899 64.4806 74.2361C61.5181 76.7328 58.0301 77.8277 54.0803 78.0532Z" fill="black"/><path d="M105.686 73.2745C103.031 73.029 100.473 72.1462 98.2312 70.701C95.9893 69.2558 94.1294 67.2912 92.8092 64.9735C91.9507 63.3999 91.5519 61.6166 91.658 59.8271C91.7061 58.825 92.9818 57.254 93.8994 57.1037C94.7566 56.9601 96.4048 58.1464 96.7671 59.1019C97.7225 61.6283 98.9665 63.733 101.334 65.1428C105.489 67.6171 108.169 66.9033 110.372 62.6372C112.149 59.1973 113.868 58.0422 115.853 58.9536C117.709 59.8061 118.149 62.2297 117.064 65.6323C115.548 70.3954 111.681 73.2393 105.686 73.2745Z" fill="black"/><path d="M41.2736 52.0625C39.2472 51.067 37.2845 49.9469 35.3967 48.7087C34.8874 48.3396 34.9017 46.8018 35.1895 45.9797C35.3249 45.6005 36.8146 45.3133 37.4769 45.5612C44.0702 48.0382 48.9443 44.7885 53.5347 40.7852C54.8714 39.6192 55.8025 37.9974 56.9746 36.6316C58.1258 35.2915 59.5126 34.0584 61.3084 35.2773C63.0656 36.4725 62.5476 38.3143 61.7621 39.8406C58.5835 46.0162 53.0858 49.0581 46.6312 50.6832C45.002 51.0936 43.3132 51.2573 41.6494 51.535C41.5235 51.7106 41.3982 51.8864 41.2736 52.0625Z" fill="black"/><path d="M111.841 48.0808C105.864 47.6597 100.966 45.7027 97.2146 41.373C96.3542 40.4872 95.7235 39.4044 95.3775 38.2189C95.1933 37.3169 95.5935 35.7925 96.2619 35.3612C96.9302 34.9298 98.7267 35.1486 99.2 35.7424C103.127 40.6707 108.366 41.8768 114.283 41.6337C116.029 41.562 117.843 42.0753 117.963 44.2638C118.074 46.2817 116.616 47.2432 114.824 47.6427C113.733 47.8865 112.609 47.9725 111.841 48.0808Z" fill="black"/><path d="M3.29432 55.9748C-3.71551 83.5259 2.42283 107.831 21.5516 128.223C22.0499 128.75 22.5571 129.277 23.065 129.785C33.34 140.06 46.1388 146.404 56.2804 150.819C60.6324 152.719 82.9668 155.028 89.0089 154.128C124.92 148.765 148.553 128.511 156.783 94.625C158.355 87.9873 159.138 81.1873 159.115 74.3661C159.154 58.2974 152.388 39.6163 138.435 25.6251C136.999 24.4373 135.568 23.2069 134.183 22.0145C131.181 19.4339 128.078 16.762 124.832 14.4834C100.034 -2.97008 74.2695 -3.06774 48.2549 6.1875C24.701 14.5618 9.57486 31.3158 3.29432 55.9748ZM48.3557 14.4373C71.181 4.95246 94.0828 3.27855 116.419 17.4844C120.504 20.0847 131.392 28.8849 133.106 30.2067L133.216 30.2879L133.307 30.3889C142.021 39.6299 152 56.5268 151.78 73.8963C151.707 81.3232 150.702 88.7115 148.787 95.8878C143.113 116.511 129.548 131.541 107.317 141.821C84.7172 152.642 52.3062 141.702 43.6828 136.01C34.1511 129.493 25.8111 121.386 19.0272 112.043C8.38782 96.9802 6.0002 75.3276 11.714 55.5339C14.3899 46.3946 19.0661 37.9653 25.4035 30.8571C31.7409 23.7489 39.5807 18.1401 48.3544 14.4373H48.3557Z" fill="black"/></svg>
    <span>No search result</span>
  </div>
`;

const loadingResult = `
  <div id="loading-result">
    <span></span>
  </div>
`;

const _408Error = `
  <div id="_408-error">
    <div>4<span></span>8</div>
    <span>Request Timeout</span>
  </div>
`;

const noInternet = `
  <div id="no-internet">
    <svg fill="none" height="24" viewBox="0 0 24 24" width="24"><path clip-rule="evenodd" d="M3.29289 3.29289C3.68342 2.90237 4.31658 2.90237 4.70711 3.29289L12.7069 11.2926V11.2926L20.7071 19.2929C21.0976 19.6834 21.0976 20.3166 20.7071 20.7071C20.3166 21.0976 19.6834 21.0976 19.2929 20.7071L11.6014 13.0156C10.2822 13.1195 9.10769 13.7348 8.27387 14.6659C7.90543 15.0773 7.27322 15.1121 6.8618 14.7437C6.45038 14.3752 6.41553 13.743 6.78398 13.3316C7.61346 12.4054 8.68764 11.7006 9.90492 11.3191L8.35444 9.76866C7.30748 10.2331 6.36481 10.892 5.57267 11.7C5.18604 12.0944 4.55291 12.1007 4.15852 11.7141C3.76414 11.3275 3.75784 10.6943 4.14447 10.3C4.93557 9.49297 5.85046 8.80708 6.85887 8.27309L5.38945 6.80366C4.88992 7.09928 4.41178 7.42745 3.95796 7.78527C3.52427 8.12722 2.89548 8.05285 2.55353 7.61916C2.21158 7.18547 2.28595 6.55668 2.71965 6.21473C3.1098 5.90711 3.51565 5.61841 3.93582 5.35004L3.29289 4.70711C2.90237 4.31658 2.90237 3.68342 3.29289 3.29289ZM12 5C11.3685 5 10.748 5.04496 10.1416 5.1317C9.59488 5.2099 9.08828 4.8301 9.01008 4.28338C8.93187 3.73666 9.31168 3.23006 9.8584 3.15185C10.5584 3.05173 11.2734 3 12 3C15.5026 3 18.7273 4.20176 21.2804 6.21473C21.714 6.55668 21.7884 7.18547 21.4465 7.61916C21.1045 8.05285 20.4757 8.12722 20.042 7.78527C17.8292 6.04052 15.0375 5 12 5ZM12.0049 7.95058C12.0595 7.40099 12.5492 6.9997 13.0988 7.05427C15.7376 7.31627 18.1013 8.51049 19.8555 10.3C20.2422 10.6943 20.2359 11.3275 19.8415 11.7141C19.4471 12.1007 18.814 12.0944 18.4273 11.7C16.9897 10.2335 15.0569 9.25851 12.9012 9.04448C12.3516 8.98992 11.9503 8.50016 12.0049 7.95058ZM12 17C11.4477 17 11 17.4477 11 18C11 18.5523 11.4477 19 12 19C12.5523 19 13 18.5523 13 18C13 17.4477 12.5523 17 12 17ZM9 18C9 16.3431 10.3431 15 12 15C13.6569 15 15 16.3431 15 18C15 19.6569 13.6569 21 12 21C10.3431 21 9 19.6569 9 18Z" fill="black" fill-rule="evenodd"/></svg>
    <span>No Internet</span>
  <div>
`;

$(function () {
	$("#search-form").on("submit", function (event) {
		event.preventDefault();
	});
	$("#search-input").on("focus", function () {
		$("#search-form").css("--border-width", "1.5px");
	});
	$("#search-input").on("blur", function () {
		$("#search-form").css("--border-width", "1px");
	});
	$("#search-by-dropdown-btn").on("click", function () {
		$("#search-by-menu").toggleClass("hidden");
	});
	$("#search-by-menu .menu-item").click(function () {
		$("#search-by").text($(this).text());
	});
	$("#search-btn").on("click", function () {
		let query;
		let searchInput = $("#search-input").val();
		searchInput = $.trim(searchInput);
		switch ($("#search-by").text()) {
			case "Author":
				query = `
          			query {
            			books: SearchByAuthor(author: "${searchInput}") {
              				id
              				title
              				url
              				author
              				co_authors
            			}
          			}
        		`;
				break;
			default:
				query = `
          			query {
            			books: SearchByTitle(title: "${searchInput}") {
              				id
              				title
              				url
              				author
              				co_authors
            			}
          			}
        		`;
		}
		$.ajax({
			url: "https://book-collection.fly.dev/graphql",
			type: "POST",
			timeout: 15000, // 15 seconds timeout
			contentType: "application/json",
			data: JSON.stringify({ query: query }),
			beforeSend: function () {
				if ($("#result-container").hasClass("hidden")) {
					$("#result-container").removeClass("hidden");
				} else {
					$("#result-container").empty();
				}
				$("#result-container").append(loadingResult);
			},
			success: function (response) {
				$("#result-container").empty();
				const books = response.data.books;
				if (books.length === 0) {
					$("#result-container").append(emptyResult);
				} else {
					$.each(books, function (index, book) {
						let authors = book.author;
						$.each(book.co_authors, function (index, author) {
							authors += `, ${author}`;
						});
						$("#result-container").append(
							`
                				<a href="${book.url}" class="search-result">
                  					<div>${book.title} <span>${authors}</span></div>
                				</a>
              				`
						);
					});
				}
			},
			error: function (xhr, status, error) {
				$("#result-container").empty();
				if (status === "timeout") {
					$("#result-container").append(_408Error);
				} else if (status === "error" && xhr.status === 0) {
					$("#result-container").append(noInternet);
				}
				console.error(status + "\n" + error);
			},
		});
	});
	$(document).on("click", function (event) {
		if (
			!$(event.target).closest("#search-by-menu, #search-by-dropdown-btn")
				.length
		) {
			$("#search-by-menu").addClass("hidden");
		}
	});
});
